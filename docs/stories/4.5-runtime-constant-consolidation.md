# Story 4.5 - Runtime Constant Consolidation

**Status:** Not Started
**Priority:** First (foundation for other Epic 4 stories)

## Overview

Extract shared runtime constants (clipboard capabilities, loader timeouts,
status labels, error codes, trigger sources) into a single module to reduce
duplication and ensure consistency across background, popup, and options
surfaces. This foundational work enables cleaner implementations for the
diagnostics and feedback stories that follow.

## Objectives

- Audit codebase for scattered constants and magic strings/numbers
- Create centralized constants module with TypeScript types
- Update all consumers to use shared constants
- Ensure tree-shaking eliminates unused constants from bundles

## Deliverables

- `src/lib/constants.ts` (or `src/constants/index.ts`) exporting all shared
  runtime values
- TypeScript enums or const objects for type-safe usage
- Updated imports across background, popup, and options modules
- Documentation in code comments explaining each constant group

## Acceptance Criteria

- [ ] Single constants module exports all shared values
- [ ] **Trigger sources:** `TRIGGER_POPUP`, `TRIGGER_HOTKEY`, `TRIGGER_CONTEXT_MENU`
- [ ] **Clipboard status flags:** Centralized capability constants
- [ ] **Timeout values:** Loader timeouts, debounce intervals in one place
- [ ] **Status labels:** Success/error message templates unified
- [ ] **Error codes:** Structured error type constants for diagnostics
- [ ] No duplicate magic strings/numbers remain in codebase
- [ ] TypeScript provides autocomplete and type checking for all constants
- [ ] Bundle size impact is negligible (tree-shaking verified)

## Technical Notes

```typescript
// Example structure
export const TRIGGER_SOURCE = {
  POPUP: 'popup',
  HOTKEY: 'hotkey',
  CONTEXT_MENU: 'context-menu',
} as const;

export type TriggerSource = typeof TRIGGER_SOURCE[keyof typeof TRIGGER_SOURCE];

export const TIMEOUTS = {
  LOADER_DISPLAY_MS: 150,
  DEBOUNCE_MS: 300,
  COPY_TIMEOUT_MS: 5000,
} as const;

export const ERROR_CODES = {
  NO_SELECTION: 'NO_SELECTION',
  CLIPBOARD_FAILED: 'CLIPBOARD_FAILED',
  PROTECTED_PAGE: 'PROTECTED_PAGE',
  SCRIPT_INJECTION_FAILED: 'SCRIPT_INJECTION_FAILED',
} as const;
```

## Risks & Mitigations

- **Import cycles:** Structure module to avoid circular dependencies; keep
  constants leaf-level with no imports from other src modules
- **Bundle size:** Tree-shaking should eliminate unused constants; verify with
  build output analysis
- **Breaking changes:** Search for all usages before consolidating; update
  tests that reference old locations

## References

- Enables: Story 4.4 (Background Alignment), Story 4.3 (Diagnostics)
- Related: Story 4.2 (Feedback UX), Story 4.1 (Confirmation Toggle)
