# Story 3.11 – Error Diagnostics and Reporting

## Overview

Story 3.11 upgrades our error-reporting pipeline so developers and testers can
reproduce failures quickly. Today the popup surfaces terse messages, there is no
copyable payload, and background logs omit context such as the source trigger or
tab URL. Smoke testing during Story 3.9 exposed how hard it is to diagnose
clipboard regressions without richer diagnostics.

## Objectives

- Embed structured metadata (trigger source, tab URL, stack traces, clipboard
  status) into every error captured by the background worker.
- Surface a “Copy error details” action in the popup that copies JSON
  diagnostics to the clipboard.
- Ensure error badges, popups, and logs stay in sync when errors are cleared or
  reset between tests.
- Update documentation so contributors know how to harvest error details during
  manual validation.

## Deliverables

- Background enhancements that record and expose structured error details.
- Popup UI affordance to copy diagnostics plus associated tests.
- Updated Playwright and unit coverage to confirm error logging across
  clear/reset cycles.
- Documentation updates (`docs/dev/test-coverage.md`,
  `docs/dev/troubleshooting.md` if needed).

## Acceptance Criteria

- Every captured error includes the trigger source, tab URL (if available),
  message, stack, and clipboard status flags.
- Popup error list displays a “Copy details” control that copies the full
  diagnostic payload.
- Clearing errors via the popup or reset commands removes stored diagnostics and
  badge counts.
- New tests validate both the data structure and the UI flow.

## Risks & Mitigations

- **Clipboard security**: ensure copied diagnostics explicitly indicate
  sensitive fields and warn users before sharing.
- **Service worker size**: compress diagnostics storage or cap entry counts to
  avoid bloating sync/state.
- **UX clutter**: keep the popup affordance compact; consider a details drawer
  if space becomes tight.

## References

- Backlog: Follow-up tasks under “Story 3.9 Completion Tasks”
