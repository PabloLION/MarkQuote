# Story 4.1 - Always-On Confirmation Toggle

**Status:** Not Started

## Overview

When users trigger copy via keyboard shortcut (Alt+C) or context menu, they
currently get no visual feedback unless the extension icon is pinned and they
click it. This story adds a user preference to automatically show the popup
after any copy action, using the `chrome.action.openPopup()` API.

## Problem

Users copying via hotkey or context menu have no way to confirm the copy
succeeded or see the formatted preview without manually clicking the extension
icon. This creates uncertainty about whether the copy worked.

## Solution

Use `chrome.action.openPopup()` API to programmatically open the popup after
copy actions, showing the formatted preview and success/error status.

## Technical Notes

- `chrome.action.openPopup()` works for unpinned extensions (Chrome 127+)
- No longer requires user gesture or policy installation
- Cannot be called from popup windows (causes crash) - only from background
- User preference toggle: "Always show confirmation after copy"
- Stored in `chrome.storage.sync` for cross-device sync

## Acceptance Criteria

- [ ] Add "Always show confirmation" toggle to options page
- [ ] Store preference in `chrome.storage.sync`
- [ ] After hotkey copy, open popup if preference enabled
- [ ] After context menu copy, open popup if preference enabled
- [ ] Popup displays the same preview/status as manual open
- [ ] Toggle default is OFF to preserve current behavior
- [ ] Works with unpinned extension icon

## Risks & Mitigations

- **Chrome version requirement:** Document minimum Chrome 127 in manifest or
  feature-detect and gracefully degrade
- **Popup crash:** Never call `openPopup()` from within popup context
- **User annoyance:** Default OFF, let users opt-in

## References

- [chrome.action.openPopup() API](https://developer.chrome.com/docs/extensions/reference/api/action#method-openPopup)
- [W3C WebExtensions Issue #160](https://github.com/w3c/webextensions/issues/160)
